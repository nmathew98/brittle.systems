---
import Base from "./Base.astro";
import { SEO } from "astro-seo";

const { file, frontmatter } = Astro.props;

// done server side no bundler issues
const article = await import(/* @vite-ignore */ file);

const getArticleTags = () => {
	if (article.tags) {
		if (Array.isArray(article.tags)) {
			return article.tags;
		}

		return article.tags.split(", ");
	}

	return frontmatter.tags.split(", ");
};

const publishedTime = article.published
	? article.published.toISOString()
	: undefined;
const modifiedTime = article.modified
	? article.modified.toISOString()
	: undefined;
const tags = getArticleTags();
---

<Base>
	<SEO
		title={`${frontmatter.title} | brittle.systems`}
		description={frontmatter.description}
		openGraph={{
			basic: {
				title: frontmatter.title,
				type: "article",
				// TODO: Same as favicon
				image: "",
			},
			optional: {
				description: frontmatter.description,
			},
			article: {
				authors: [frontmatter.author],
				publishedTime: publishedTime,
				modifiedTime: modifiedTime,
				section: frontmatter.section,
				tags: tags,
			},
		}}
		slot="head"
	/>
	<slot />
</Base>
